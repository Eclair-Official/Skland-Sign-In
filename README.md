# Skland-Sign-In

æ£®ç©ºå²›è‡ªåŠ¨ç­¾åˆ°è„šæœ¬ï¼Œç”¨äºå®ç°æ£®ç©ºå²›å¹³å°ä¸‹ã€Šæ˜æ—¥æ–¹èˆŸã€‹ä¸ã€Šç»ˆæœ«åœ°ã€‹çš„æ¯æ—¥è‡ªåŠ¨ç­¾åˆ°ã€‚  
æ”¯æŒå¤šè´¦å·ç®¡ç†ã€‚

## å‰ææ¡ä»¶
**å¦‚ä½•è·å– Tokenï¼š**

1. ç™»å½• [æ£®ç©ºå²›å®˜ç½‘](https://www.skland.com/)ã€‚
2. ç™»å½•æˆåŠŸåï¼Œè®¿é—®æ­¤é“¾æ¥ï¼š[é“¾æ¥](https://web-api.skland.com/account/info/hg)
3. é¡µé¢å°†è¿”å›ä¸€æ®µ JSONæ•°æ®ã€‚è¯·å¤åˆ¶ `content` å­—æ®µä¸­çš„é•¿å­—ç¬¦ä¸²ã€‚

- æ•°æ®ç¤ºä¾‹ï¼š`{"code":0,"data":{"content":"è¯·å¤åˆ¶è¿™ä¸€é•¿ä¸²å­—ç¬¦"}}`


## ä¸€ã€åŸºäºGithub Actionæ„å»º

> GitHub Secrets é…ç½®è¯´æ˜ï¼ˆæ£®ç©ºå²›è‡ªåŠ¨ç­¾åˆ°ï¼‰

### 1.åœ¨ GitHub ä¸­é…ç½® Secrets

> æˆ‘ä»¬å°†ä»¥é…ç½®å•ä¸ªè´¦æˆ·å’Œå¤šä¸ªè´¦æˆ·ä¸¤ç§åœºæ™¯ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚

#### ç¬¬ä¸€æ­¥ï¼šè¿›å…¥ Actions Secrets é…ç½®é¡µé¢

1. æ‰“å¼€ä½ çš„ **`GitHub`** ä»“åº“ä¸»é¡µã€‚
2. ç‚¹å‡»ä»“åº“å¯¼èˆªæ ä¸Šæ–¹çš„ **`Settings`** (è®¾ç½®) é€‰é¡¹å¡ã€‚
3. åœ¨å·¦ä¾§èœå•ä¸­ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡» **`Secrets and variables`** (å¯†é’¥å’Œå˜é‡)ï¼Œç„¶åå±•å¼€å¹¶é€‰æ‹© **`Actions`**ã€‚
4. ä½ ä¼šçœ‹åˆ°ä¸¤ä¸ªé€‰é¡¹å¡ï¼š**`secrets`** å’Œ **`variables`**ã€‚æˆ‘ä»¬é€‰æ‹© **`secrets`** ï¼Œç‚¹å‡»å®ƒæ—è¾¹çš„ **`New repository secret`** æŒ‰é’®ã€‚

#### 1.é…ç½®å•ä¸ªè´¦æˆ·ï¼ˆæœ€ç®€å•ï¼‰

    å¦‚æœä½ åªæœ‰ä¸€ä¸ªæ£®ç©ºå²›è´¦æˆ·éœ€è¦ç­¾åˆ°ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æœ€ç›´æ¥ã€‚

ç‚¹å‡» **`New repository secret`** ï¼Œå¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

> **Name (åç§°)** : **`SKLAND_TOKEN`**
>
> **Secret (å¯†é’¥)** : **ç²˜è´´ä½ è·å–åˆ°çš„å®Œæ•´ Token å­—ç¬¦ä¸²**ã€‚

**ç¤ºä¾‹å›¾**ï¼šé…ç½® SKLAND_TOKEN
![token.png](img%2Ftoken.png)

ç‚¹å‡» **`Add secret`** æŒ‰é’®ã€‚

**(å¯é€‰)** æ·»åŠ æ˜µç§°ï¼š

å†æ¬¡ç‚¹å‡» **`New repository secret`**ï¼Œæ·»åŠ ä¸€ä¸ªä¾¿äºè¯†åˆ«çš„æ˜µç§°ï¼š

> **Name (åç§°)** : **`SKLAND_NICKNAME`**
>
> **Secret (å¯†é’¥)** : è¾“å…¥ä¸€ä¸ªä½ å–œæ¬¢çš„åå­—(åç¼€åŠ  "\_END")ï¼Œä¾‹å¦‚ **æˆ‘çš„æ˜æ—¥æ–¹èˆŸè´¦å·**\_ENDã€‚

**ç¤ºä¾‹å›¾**ï¼šé…ç½® SKLAND_NICKNAME
![name.png](img%2Fname.png)
å†æ¬¡ç‚¹å‡» **`Add secret`**ã€‚

ç¤ºä¾‹å›¾ï¼š

![show.png](img%2Fshow.png)

è‡³æ­¤ï¼Œå•è´¦æˆ·é…ç½®å®Œæˆï¼ä½ çš„å·¥ä½œæµå°†è‡ªåŠ¨è¯†åˆ«è¿™ä¸¤ä¸ªå¯†é’¥å¹¶ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚

#### 2.é…ç½®å¤šä¸ªè´¦æˆ·ï¼ˆæ¨èç”¨äºå°å·/å®¶åº­å·ï¼‰

    å¦‚æœä½ æœ‰å¤šä¸ªè´¦æˆ·éœ€è¦ç­¾åˆ°ï¼Œåªéœ€è¦æ·»åŠ SKLAND_ACCOUNTS_JSONå³å¯ã€‚

##### æ·»åŠ  SKLAND_ACCOUNTS_JSONï¼š

ç‚¹å‡» **`New repository secret`**ï¼Œæ·»åŠ ï¼š

> - Name: **`SKLAND_ACCOUNTS_JSON`**
> - Secret: **`é…ç½®æ–‡ä»¶`**

é…ç½®æ–‡ä»¶æ ¼å¼

```json
[
  {
      "nickname": "æˆ‘çš„å¤§å·", 
      "token": "token_for_account_with_nickname",
  },
  {  
      "nickname": "æˆ‘çš„å°å·",
      "token": "token_for_account_without_nickname"
  }
]
```

æˆ–è€…

```json
[
	{ "æˆ‘çš„å¤§å·": "token_1" },
	{ "æˆ‘çš„å°å·": "token_2" }
]
```



ç‚¹å‡» **`Add secret`**ã€‚

è‡³æ­¤ï¼Œå¤šè´¦æˆ·é…ç½®å®Œæˆï¼ã€‚

### 2.åœ¨ GitHub ä¸­é…ç½® Action

1. åœ¨æ–°åˆ›å»ºçš„ä»“åº“é¡µé¢ï¼Œç‚¹å‡» **`Add file`** -> **`Create new file`**ã€‚
2. åœ¨æ–‡ä»¶åè¾“å…¥æ¡†ä¸­ï¼Œè¾“å…¥å®Œæ•´è·¯å¾„ï¼Œä¾‹å¦‚ **`.github/workflows/skland-auto-sign-in.yml`**ã€‚
3. å°†ä¸‹æ–¹ YAML å†…å®¹ç²˜è´´åˆ°ä»£ç ç¼–è¾‘å™¨ä¸­ã€‚
4. ç‚¹å‡» **`Commit new file`**ã€‚

```yaml
# .github/workflows/skland.yml

# =================================================================================
# å·¥ä½œæµåç§°
# æè¿°ï¼šè¿™ä¸ªå·¥ä½œæµçš„åç§°ï¼Œä¼šæ˜¾ç¤ºåœ¨ GitHub Actions çš„é¡µé¢ä¸Šã€‚
# =================================================================================
name: Skland Auto Sign-In (Final Version)

# =================================================================================
# è§¦å‘æ¡ä»¶
# æè¿°ï¼šå®šä¹‰ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè‡ªåŠ¨è¿è¡Œè¿™ä¸ªå·¥ä½œæµã€‚
# - schedule: å®šæ—¶ä»»åŠ¡ï¼Œä½¿ç”¨ cron è¯­æ³•ã€‚'0 0 * * *' è¡¨ç¤ºæ¯å¤© UTC 0ç‚¹æ‰§è¡Œï¼ˆåŒ—äº¬æ—¶é—´æ—©ä¸Š8ç‚¹ï¼‰ã€‚
# - workflow_dispatch: å…è®¸åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘ï¼Œéå¸¸æ–¹ä¾¿æµ‹è¯•ã€‚
# =================================================================================
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

# =================================================================================
# æƒé™è®¾ç½®
# æè¿°ï¼šä¸ºæ•´ä¸ªå·¥ä½œæµè®¾ç½®é»˜è®¤çš„æƒé™ã€‚
# contents: read è¡¨ç¤ºåªè¯»ä»“åº“å†…å®¹ï¼Œè¿™æ˜¯æœ€å®‰å…¨ã€æœ€å°æƒé™çš„åŸåˆ™ã€‚
# =================================================================================
permissions:
  contents: read

# =================================================================================
# ä»»åŠ¡å®šä¹‰
# æè¿°ï¼šä¸€ä¸ªå·¥ä½œæµå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚è¿™é‡Œæˆ‘ä»¬åªå®šä¹‰äº†ä¸€ä¸ªåä¸º `skland-sign-task` çš„ä»»åŠ¡ã€‚
# =================================================================================
jobs:
  skland-sign-task:
    # =================================================================================
    # ä»»åŠ¡è¿è¡Œç¯å¢ƒ
    # æè¿°ï¼šæŒ‡å®šä»»åŠ¡åœ¨å“ªç§ç±»å‹çš„è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚ubuntu-latest æ˜¯æœ€æ–°ç‰ˆçš„ Ubuntu ç³»ç»Ÿã€‚
    # =================================================================================
    runs-on: ubuntu-latest
    
    # =================================================================================
    # ä»»åŠ¡æ­¥éª¤
    # æè¿°ï¼šä»»åŠ¡ç”±ä¸€ç³»åˆ—æŒ‰é¡ºåºæ‰§è¡Œçš„æ­¥éª¤ç»„æˆã€‚
    # =================================================================================
    steps:
      # ---------------------------------------------------------------------------------
      # æ­¥éª¤ 1: æ‹‰å–ä»£ç 
      # æè¿°ï¼šä½¿ç”¨ actions/checkout è¿™ä¸ªå®˜æ–¹ Actionï¼Œå°†æ‚¨ä»“åº“çš„ä»£ç ä¸‹è½½åˆ°è™šæ‹Ÿæœºä¸­ã€‚
      # ---------------------------------------------------------------------------------
      - name: Checkout code
        uses: actions/checkout@v4

      # ---------------------------------------------------------------------------------
      # æ­¥éª¤ 2: é…ç½® Python ç¯å¢ƒ
      # æè¿°ï¼šä½¿ç”¨ actions/setup-python è¿™ä¸ªå®˜æ–¹ Action æ¥è®¾ç½®æˆ‘ä»¬éœ€è¦çš„ Python ç‰ˆæœ¬ã€‚
      # - with: ä¼ é€’å‚æ•°ç»™ Actionã€‚
      #   - python-version: æŒ‡å®š Python ç‰ˆæœ¬ä¸º 3.10ã€‚
      #   - cache: å¯ç”¨ pip ç¼“å­˜ï¼Œèƒ½æ˜¾è‘—åŠ å¿«åç»­ä¾èµ–å®‰è£…é€Ÿåº¦ã€‚
      #   - cache-dependency-path: æŒ‡å®šç¼“å­˜ä¾æ®çš„æ–‡ä»¶ã€‚
      # ---------------------------------------------------------------------------------
      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
          cache-dependency-path: 'requirements.txt'

      # ---------------------------------------------------------------------------------
      # æ­¥éª¤ 3: å®‰è£…é¡¹ç›®ä¾èµ–
      # æè¿°ï¼šè¿è¡Œ Shell å‘½ä»¤æ¥å®‰è£…æ‰€æœ‰å¿…éœ€çš„ Python åº“å’Œå·¥å…·ã€‚
      # - |: å…è®¸æˆ‘ä»¬ç¼–å†™å¤šè¡Œè„šæœ¬ã€‚
      # ---------------------------------------------------------------------------------
      - name: Install dependencies
        run: |
          # å‡çº§ pip è‡ªèº«åˆ°æœ€æ–°ç‰ˆæœ¬
          python -m pip install --upgrade pip
          # æ£€æŸ¥ requirements.txt æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿™æ˜¯é¡¹ç›®ä¾èµ–çš„æ¸…å•
          if [ ! -f requirements.txt ]; then
            echo "âŒ é”™è¯¯: æœªæ‰¾åˆ° requirements.txt æ–‡ä»¶ï¼"
            exit 1
          fi
          # æ ¹æ® requirements.txt å®‰è£…æ‰€æœ‰é¡¹ç›®ä¾èµ–
          pip install -r requirements.txt
          # å®‰è£… PyYAMLï¼Œå› ä¸ºæˆ‘ä»¬çš„ generate_config.py è„šæœ¬éœ€è¦å®ƒæ¥å¤„ç† YAML æ–‡ä»¶
          pip install PyYAML
          # å®‰è£… yqï¼Œä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œ YAML/JSON å¤„ç†å·¥å…·ï¼Œç”¨äºåç»­çš„è°ƒè¯•æ­¥éª¤
          echo "ğŸ”§ å®‰è£… yq..."
          sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
          sudo chmod +x /usr/local/bin/yq
          echo "âœ… yq å®‰è£…å®Œæˆã€‚"

      # ---------------------------------------------------------------------------------
      # æ­¥éª¤ 4: ç”Ÿæˆé…ç½®æ–‡ä»¶
      # æè¿°ï¼šè¿™æ˜¯æˆ‘ä»¬é€»è¾‘çš„æ ¸å¿ƒã€‚æ­¤æ­¥éª¤å°†å­˜å‚¨åœ¨ GitHub Secrets ä¸­çš„è´¦å·ä¿¡æ¯ï¼Œ
      #      é€šè¿‡ generate_config.py è„šæœ¬è½¬æ¢æˆ main.py éœ€è¦çš„ config.yaml æ–‡ä»¶ã€‚
      # - env: å®šä¹‰æ­¤æ­¥éª¤ä¸­å¯ç”¨çš„ç¯å¢ƒå˜é‡ã€‚æˆ‘ä»¬å°†ä»“åº“ Secrets çš„å€¼æ³¨å…¥è¿›æ¥ã€‚
      # ---------------------------------------------------------------------------------
      - name: Generate config from Secrets
        env:
          SKLAND_ACCOUNTS_JSON: ${{ secrets.SKLAND_ACCOUNTS_JSON }}
          SKLAND_TOKEN: ${{ secrets.SKLAND_TOKEN }}
          SKLAND_NICKNAME: ${{ secrets.SKLAND_NICKNAME }}
        run: |
          # è°ƒç”¨æˆ‘ä»¬çš„ Python è„šæœ¬æ¥å®Œæˆè½¬æ¢
          python generate_config.py

      # ---------------------------------------------------------------------------------
      # æ­¥éª¤ 5: è°ƒè¯• - æ‰“å°é…ç½®æ‘˜è¦
      # æè¿°ï¼šåœ¨æ‰§è¡Œä¸»ç¨‹åºå‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹ç”Ÿæˆçš„ config.yaml æ–‡ä»¶æ˜¯å¦æ­£ç¡®ã€‚
      #      ä½¿ç”¨ yq å·¥å…·å¯ä»¥ä¼˜é›…åœ°æå– YAML ä¸­çš„ä¿¡æ¯ï¼Œéå¸¸å¯é ã€‚
      # ---------------------------------------------------------------------------------
      - name: Debug - Show user summary (Using yq)
        run: |
          echo "=== é…ç½®æ‘˜è¦ ==="
          # æ£€æŸ¥ config.yaml æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ -f "config.yaml" ]; then
            # æå–å¹¶æ‰“å°æ—¥å¿—ç­‰çº§
            echo "æ—¥å¿—ç­‰çº§: $(yq '.log_level' config.yaml)"
            # æå–å¹¶æ‰“å°ç”¨æˆ·æ•°é‡
            echo "å·²é…ç½®çš„ç”¨æˆ·æ•°é‡: $(yq '.users | length' config.yaml)"
            # æå–å¹¶æ‰“å°æ‰€æœ‰ç”¨æˆ·çš„æ˜µç§°åˆ—è¡¨
            echo "ç”¨æˆ·æ˜µç§°åˆ—è¡¨:"
            yq '.users[].nickname' config.yaml | sed 's/^/- /'
          else
            echo "âŒ config.yaml æ–‡ä»¶æœªç”Ÿæˆï¼Œè¯·æ£€æŸ¥ä¸Šä¸€æ­¥çš„æ—¥å¿—ã€‚"
            exit 1
          fi
          echo "==================="

      # ---------------------------------------------------------------------------------
      # æ­¥éª¤ 6: æ‰§è¡Œç­¾åˆ°è„šæœ¬
      # æè¿°ï¼šæ‰€æœ‰å‡†å¤‡å·¥ä½œå°±ç»ªï¼Œç°åœ¨è¿è¡ŒçœŸæ­£çš„ç­¾åˆ°ç¨‹åº main.pyã€‚
      # ---------------------------------------------------------------------------------
      - name: Run sign-in script
        run: |
          python main.py

      # ---------------------------------------------------------------------------------
      # æ­¥éª¤ 7: ä¸Šä¼ æ—¥å¿—
      # æè¿°ï¼šæ— è®ºç­¾åˆ°æˆåŠŸä¸å¦ï¼Œéƒ½å°†æ—¥å¿—æ–‡ä»¶æ‰“åŒ…ä¸Šä¼ ã€‚
      #      è¿™å¯¹äºäº‹åæ’æŸ¥é—®é¢˜è‡³å…³é‡è¦ã€‚
      # - uses: è°ƒç”¨ actions/upload-artifact è¿™ä¸ª Action æ¥ä¸Šä¼ æ–‡ä»¶ã€‚
      # - with: ä¼ é€’å‚æ•°ç»™ Actionã€‚
      #   - name: å®šä¹‰æ„å»ºäº§ç‰©çš„åç§°ï¼Œè¿™é‡Œç”¨è¿è¡Œç¼–å·æ¥åŒºåˆ†ã€‚
      #   - path: æŒ‡å®šè¦ä¸Šä¼ çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚
      #   - retention-days: è®¾ç½®äº§ç‰©çš„ä¿ç•™å¤©æ•°ï¼Œé¿å…å ç”¨è¿‡å¤šå­˜å‚¨ç©ºé—´ã€‚
      #   - if-no-files-found: å¦‚æœè·¯å¾„ä¸‹æ²¡æœ‰æ–‡ä»¶ï¼Œæ˜¯æŠ¥é”™è¿˜æ˜¯è­¦å‘Šã€‚
      # - if: always() æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¡ä»¶ï¼Œè¡¨ç¤ºæ— è®ºå‰é¢çš„æ­¥éª¤æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½æ‰§è¡Œæ­¤æ­¥éª¤ã€‚
      # ---------------------------------------------------------------------------------
      - name: Upload log file
        uses: actions/upload-artifact@v4
        with:
          name: sign-in-log-${{ github.run_number }}
          path: ./log
          retention-days: 7
          if-no-files-found: warn
        if: always()

```



## äºŒã€æœ¬åœ°æ„å»º

### ç¯å¢ƒè¦æ±‚

- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬

### å®‰è£…æ­¥éª¤

1. å…‹éš†æˆ–ä¸‹è½½æœ¬é¡¹ç›®åˆ°æœ¬åœ°ã€‚

```bash
git clone https://github.com/Eclair-Official/Skland-Sign-In.git && cd Skland-Sign-In
```

2. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå®‰è£…æ‰€éœ€ä¾èµ–ï¼š

```bash
pip install -r requirements.txt
```

### é…ç½®æŒ‡å—

åœ¨ä½¿ç”¨å‰ï¼Œè¯·å°†ç›®å½•ä¸‹çš„ `config.example.yaml` æ–‡ä»¶å¦å­˜ä¸º`config.yaml`è¿›è¡Œé…ç½®ã€‚

```bash
cp config.example.yaml config.yaml
```

#### 1. å¡«å†™ç”¨æˆ·ä¿¡æ¯

åœ¨ `users` åˆ—è¡¨ä¸‹å¡«å†™è´¦å·æ˜µç§°å’Œ Tokenã€‚

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
# æ—¥å¿—ç­‰çº§: debug (æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯) æˆ– info (ä»…æ˜¾ç¤ºç»“æœ)
log_level: 'info'

users:
    - nickname: 'è´¦å·A'
      token: 'Tokenå­—ç¬¦ä¸²'

    - nickname: 'è´¦å·B'
      token: 'å¦ä¸€ä¸ªToken'
```

### è¿è¡Œæ–¹æ³•

åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨è„šæœ¬ï¼š

```bash
python3 main.py
```

è„šæœ¬è¿è¡Œåä¼šä¾æ¬¡æ£€æŸ¥æ¯ä¸ªé…ç½®è´¦å·çš„ç­¾åˆ°çŠ¶æ€ï¼š

- è‹¥æœªç­¾åˆ°ï¼Œåˆ™æ‰§è¡Œç­¾åˆ°å¹¶è·å–å¥–åŠ±å†…å®¹ã€‚
- è‹¥å·²ç­¾åˆ°ï¼Œåˆ™è·³è¿‡ã€‚
- å»ºè®®é…åˆè®¡åˆ’ä»»åŠ¡å®ç°æ¯æ—¥è‡ªåŠ¨è¿è¡Œï¼Œç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šï¼Œæ­¤å¤„ä¸èµ˜è¿°ã€‚
